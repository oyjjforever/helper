(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["tickets-maintain"],{6170:function(e,i,t){},"721b":function(e,i,t){"use strict";var n=t("6170"),s=t.n(n);s.a},"91ab":function(e,i,t){"use strict";t.r(i);var n=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"tickets-maintain"},[t("div",{staticClass:"grid-container"},[t("div",{staticClass:"left"},[t("div",{staticClass:"title"},[e._v("财政票据库存所有的票据种类")]),t("div",{staticClass:"search"},[t("el-input",{attrs:{clearable:"",placeholder:"输入票据编码或票据名称进行搜索"},model:{value:e.searcher,callback:function(i){e.searcher="string"===typeof i?i.trim():i},expression:"searcher"}}),t("div",{staticStyle:{width:"20px"}}),t("el-button",{staticClass:"searchBtn",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.queryFinanceBills}},[e._v("查询")])],1),t("el-tree",{ref:"financeBillTree",staticClass:"tree",attrs:{data:e.financeBills,props:e.financeBills,"default-expand-all":"","show-checkbox":e.showCheckbox},on:{check:e.changeAddBtnStatus}})],1),t("div",{staticClass:"middle"},[t("div",{staticClass:"addBtn"},[t("el-button",{attrs:{type:"primary",size:"large",disabled:e.isAddBtnDisabled},on:{click:e.add}},[e._v(" > ")])],1),t("div",{staticClass:"removeBtn"},[t("el-button",{attrs:{type:"primary",size:"large",disabled:e.isRemoveBtnDisabled},on:{click:e.remove}},[e._v(" < ")])],1)]),t("div",{staticClass:"right"},[t("div",{staticClass:"title"},[e._v("列入监控的票据种类")]),t("el-tree",{ref:"chosenBillTree",staticClass:"tree",attrs:{data:e.chosenBills,props:e.chosenBills,"show-checkbox":""},on:{check:e.changeRemoveBtnStatus}})],1)])])},s=[],a=(t("20d6"),t("96cf"),t("3b8d")),r=(t("ac6a"),{name:"tickets-maintain",data:function(){return{searcher:null,showCheckbox:!0,billNumLimit:10,financeBills:[],chosenBills:[],isAddBtnDisabled:!0,isRemoveBtnDisabled:!0}},created:function(){this.initTransfer()},methods:{initTransfer:function(){this.queryChosenBills().then(this.queryFinanceBills())},jsonTree:function(e,i){var t=(null===i||void 0===i?void 0:i.id)||"id",n=(null===i||void 0===i?void 0:i.pid)||"pid",s=(null===i||void 0===i?void 0:i.children)||"children",a=[],r=[];return e.forEach((function(e){a[e[t]]=e})),e.forEach((function(e){e.label=e.billCode+" "+e.label;var i=a[e[n]];delete e.parent,i?(!i[s]&&(i[s]=[]),i[s].push(e)):r.push(e)})),r},queryFinanceBills:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var i,t,n,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.queryData({params:{mapperId:"com.bosssoft.monitor.dao.MonitorBillTypeMapper.queryFinanceBills",searcher:this.searcher}});case 2:i=e.sent,t=i.data,t.data.length>0?(this.showCheckbox=!0,n=this.jsonTree(t.data),this.financeBills=[{id:0,label:"票据种类",children:n}],this.chosenBills.forEach((function(e){s.disableLeaf(s.financeBills[0],e)}))):(this.showCheckbox=!1,this.financeBills=[{id:0,label:"未找到符合条件的票据"}]);case 5:case"end":return e.stop()}}),e,this)})));function i(){return e.apply(this,arguments)}return i}(),queryChosenBills:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var i,t,n,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.queryData({params:{mapperId:"com.bosssoft.monitor.dao.MonitorBillTypeMapper.queryChosenBills"}});case 2:i=e.sent,t=i.data,this.chosenBills=[],n=t.data,n&&(null===n||void 0===n?void 0:n.length)>0&&n.forEach((function(e,i){s.chosenBills.push({id:e.billId,label:null})}));case 7:case"end":return e.stop()}}),e,this)})));function i(){return e.apply(this,arguments)}return i}(),disableLeaf:function(e,i){if(e.children){for(var t=0;t<e.children.length;t++)this.disableLeaf(e.children[t],i);var n=0;e.children.forEach((function(e){e.disabled&&n++})),n===e.children.length&&(e.disabled=!0)}else e.id===i.id&&(e.disabled=!0,i.label=e.label)},enableLeaf:function(e,i){if(e.children){for(var t=0;t<e.children.length;t++)this.enableLeaf(e.children[t],i);var n=0;e.children.forEach((function(e){e.disabled||n++})),n===e.children.length&&(e.disabled=!1)}else e.id===i.id&&(e.disabled=!1)},add:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(i,t,n){var s,a,r,l=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s=this.$refs.financeBillTree.getCheckedNodes(),a=[],s.forEach((function(e){1===e.isLeaf&&a.push({id:e.id,label:e.label})})),!(a.length+this.chosenBills.length<=this.billNumLimit)){e.next=12;break}return e.next=6,this.$api.add({data:{mapperId:"com.bosssoft.monitor.dao.MonitorBillTypeMapper.batchInsert",billIds:JSON.stringify(a.map((function(e){return e.id})))}});case 6:r=JSON.parse(JSON.stringify(this.financeBills)),a.forEach((function(e){l.chosenBills.push(e),l.disableLeaf(r[0],e)})),this.financeBills=r,this.isAddBtnDisabled=!0,e.next=13;break;case 12:0===document.getElementsByClassName("el-message").length&&this.$message.info("最多添加"+this.billNumLimit+"种票据！");case 13:case"end":return e.stop()}}),e,this)})));function i(i,t,n){return e.apply(this,arguments)}return i}(),remove:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var i,t,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=this.$refs.chosenBillTree.getCheckedNodes(),e.next=3,this.$api.remove({params:{mapperId:"com.bosssoft.monitor.dao.MonitorBillTypeMapper.batchDelete",billIds:JSON.stringify(i.map((function(e){return e.id})))}});case 3:t=JSON.parse(JSON.stringify(this.financeBills)),i.forEach((function(e){var i=e.id;n.chosenBills.splice(n.chosenBills.findIndex((function(e){return e.id===i})),1),n.enableLeaf(t[0],e)})),this.financeBills=t,this.isAddBtnDisabled=!0,this.isRemoveBtnDisabled=!0;case 8:case"end":return e.stop()}}),e,this)})));function i(){return e.apply(this,arguments)}return i}(),changeAddBtnStatus:function(e,i){this.isAddBtnDisabled=!i.checkedKeys.length>0},changeRemoveBtnStatus:function(e,i){this.isRemoveBtnDisabled=!i.checkedKeys.length>0}}}),l=r,c=(t("721b"),t("2877")),o=Object(c["a"])(l,n,s,!1,null,"0c24471a",null);i["default"]=o.exports}}]);
//# sourceMappingURL=tickets-maintain.4617f14b.js.map